<div class="flex-1 bg-gray-50 p-6 flex items-center justify-center">
  <div class="max-w-6xl mx-auto w-full">
    <!-- Header -->
    <div class="mb-6">
      <h1 class="text-xl font-bold text-gray-800">Actualizar Usuario</h1>
      <p class="text-sm text-gray-600 mt-1">Busca un usuario y modifica sus datos</p>
    </div>

    <!-- Search Section -->
    <div class="bg-white rounded-2xl shadow-md p-6 mb-8">
      <div class="flex flex-col md:flex-row gap-4 items-end">
        <div class="flex-1 w-full">
          <label class="block text-sm font-medium text-gray-700 mb-2">Código de Usuario</label>
          <div class="relative">
            <span
              class="absolute inset-y-0 left-3 flex items-center text-gray-400 pointer-events-none"
            >
              <i class="fa-solid fa-hashtag"></i>
            </span>
            <input
              type="number"
              [(ngModel)]="searchId"
              (keyup.enter)="buscar()"
              class="w-full pl-10 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-all text-sm placeholder:text-gray-500"
              placeholder="Ej. 1"
            />
          </div>
        </div>
        <div class="flex gap-2 w-full md:w-auto">
          <button
            (click)="buscar()"
            [disabled]="loading()"
            class="flex-1 md:flex-none px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors font-medium shadow-md text-sm flex justify-center items-center gap-2"
          >
            @if (loading() && !user()) {
            <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
            Buscando... } @else { Buscar }
          </button>
          <button
            (click)="limpiar()"
            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium text-sm"
          >
            Limpiar
          </button>
        </div>
      </div>
    </div>

    <!-- Update Form -->
    @if (user()) {
    <div class="bg-white rounded-2xl shadow-md overflow-hidden animate-fade-in">
      <form (ngSubmit)="actualizar()">
        <fieldset [disabled]="isLockedByOther()" class="contents">
          <div class="p-8">
            <!-- Lock Warning -->
            @if (isLockedByOther()) {
            <div class="mb-6 bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg animate-fade-in">
              <div class="flex items-center">
                <div class="shrink-0">
                  <i class="fa-solid fa-lock text-red-500 text-xl"></i>
                </div>
                <div class="ml-3">
                  <p class="text-sm text-red-700 font-bold">Edición Bloqueada</p>
                  <p class="text-sm text-red-600">
                    El usuario está siendo editado por:
                    <span class="font-semibold">{{ lockOwner() }}</span>
                  </p>
                </div>
              </div>
            </div>
            }

            <!-- Avatar y Campos superiores -->
            <div class="flex flex-col md:flex-row gap-6 mb-6">
              <!-- Avatar -->
              <div class="shrink-0 flex flex-col items-center">
                <div class="w-32 h-32 rounded-full overflow-hidden shadow-lg bg-gray-100">
                  <img
                    src="https://i.pravatar.cc/150?img={{ user()!.cod_usuario }}"
                    alt="Avatar"
                    class="w-full h-full object-cover"
                  />
                </div>
                <div class="mt-3 text-center">
                  <span
                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700"
                  >
                    <i class="fa-solid fa-pen-to-square text-[8px] mr-1.5"></i>
                    Editando
                  </span>
                </div>
              </div>

              <!-- Campos a la derecha del avatar -->
              <div class="flex-1 space-y-4">
                <!-- Apellidos y Nombres -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <!-- Apellidos -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">
                      Apellidos <span class="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      [(ngModel)]="apellidos"
                      name="apellidos"
                      required
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-all text-sm text-gray-800"
                      placeholder="Ingrese apellidos"
                    />
                  </div>

                  <!-- Nombres -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">
                      Nombres <span class="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      [(ngModel)]="nombres"
                      name="nombres"
                      required
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-all text-sm text-gray-800"
                      placeholder="Ingrese nombres"
                    />
                  </div>
                </div>

                <!-- Correo y Celular -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <!-- Correo -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">
                      Correo Electrónico <span class="text-red-500">*</span>
                    </label>
                    <input
                      type="email"
                      [(ngModel)]="correo"
                      name="correo"
                      required
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-all text-sm text-gray-800"
                      placeholder="correo@ejemplo.com"
                    />
                  </div>

                  <!-- Celular -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5"> Celular </label>
                    <input
                      type="tel"
                      [(ngModel)]="celular"
                      name="celular"
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-all text-sm text-gray-800"
                      placeholder="999 999 999"
                    />
                  </div>
                </div>

                <!-- Nivel y Estado (Admin Only Fields) -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <!-- Nivel -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">
                      Nivel de Acceso <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                      <select
                        [(ngModel)]="nivel"
                        name="nivel"
                        class="w-full pl-3 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-all text-sm text-gray-800 bg-white appearance-none"
                      >
                        <option [value]="1">Supervisor</option>
                        <option [value]="2">Vendedor</option>
                        <option [value]="3">Cliente</option>
                      </select>
                      <span
                        class="absolute inset-y-0 right-3 flex items-center text-gray-400 pointer-events-none"
                      >
                        <i class="fa-solid fa-chevron-down text-xs"></i>
                      </span>
                    </div>
                  </div>

                  <!-- Estado -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">
                      Estado <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                      <select
                        [(ngModel)]="estado"
                        name="estado"
                        class="w-full pl-3 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-all text-sm text-gray-800 bg-white appearance-none"
                      >
                        <option [value]="1">Activo</option>
                        <option [value]="0">Inactivo</option>
                      </select>
                      <span
                        class="absolute inset-y-0 right-3 flex items-center text-gray-400 pointer-events-none"
                      >
                        <i class="fa-solid fa-chevron-down text-xs"></i>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Cambiar Contraseña Section -->
            <div class="pt-4 border-t border-gray-200 mt-4">
              <button
                type="button"
                (click)="togglePasswordFields()"
                class="flex items-center text-blue-600 hover:text-blue-700 font-medium mb-3 text-sm"
              >
                <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    [attr.d]="showPasswordFields() ? 'M19 9l-7 7-7-7' : 'M9 5l7 7-7 7'"
                  />
                </svg>
                {{ showPasswordFields() ? 'Ocultar cambio de contraseña' : 'Cambiar contraseña' }}
              </button>

              @if (showPasswordFields()) {
              <div class="space-y-3 bg-blue-50 p-4 rounded-lg animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <!-- Nueva Contraseña -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">
                      Nueva Contraseña <span class="text-red-500">*</span>
                    </label>
                    <input
                      type="password"
                      [(ngModel)]="password"
                      name="password"
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-all text-sm text-gray-800"
                      placeholder="Mínimo 6 caracteres"
                    />
                  </div>

                  <!-- Confirmar Contraseña -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">
                      Confirmar Contraseña <span class="text-red-500">*</span>
                    </label>
                    <input
                      type="password"
                      [(ngModel)]="confirmPassword"
                      name="confirmPassword"
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-all text-sm text-gray-800"
                      placeholder="Repita la contraseña"
                    />
                  </div>
                </div>
                @if (password() && confirmPassword() && password() !== confirmPassword()) {
                <p class="text-xs text-red-600 font-medium">Las contraseñas no coinciden</p>
                }
              </div>
              }
            </div>

            <!-- Buttons -->
            <div class="flex gap-3 justify-end mt-8 border-t border-gray-100 pt-6">
              <button
                type="button"
                (click)="cancelar()"
                [disabled]="loading()"
                class="px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 transition-colors font-medium text-sm"
              >
                Cancelar
              </button>
              <button
                type="submit"
                [disabled]="loading() || isLockedByOther()"
                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-colors font-medium text-sm flex items-center gap-2"
              >
                @if (loading()) {
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                Actualizando... } @else { Actualizar Usuario }
              </button>
            </div>
          </div>
        </fieldset>
      </form>
    </div>
    } @else if (!loading() && searchId()) {
    <div class="flex flex-col items-center justify-center py-12 text-gray-400">
      <i class="fa-solid fa-user-pen text-6xl mb-4"></i>
      <p class="text-lg">Realiza una búsqueda para editar el usuario</p>
    </div>
    }
  </div>
</div>
